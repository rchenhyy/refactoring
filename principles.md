## 重构原则

### 何谓重构

重构（名词）：对软件内部结构的一种调整，目的是在不改变软件可观察行为的前提下，提高其可理解性，降低其修改成本。<br/>
重构（动词）：使用一系列重构手法，在不改变软件可观察行为的前提下，调整其结构。

#### 两顶帽子
1. 添加新功能：添加新功能时，你不应该修改既有代码，只管添加新功能
2. 重构：重构时你就不能再添加功能，只管改进程序结构

无论何时，你都应该清楚自己戴的是哪一顶帽子。

### 为何重构

1. 重构改进软件设计
2. 重构使软件更容易理解
3. 重构帮助找到bug
4. 重构提高编程速度

#### 何时重构

三次法则：
第一次做某件事时只管去做；第二次做类似的事会产生反感，但无论如何还是可以去做；第三次再做类似的事，你就应该重构。

```
事不过三，三则重构
```

1. 添加功能时重构
2. 修改错误时重构
3. 复审代码时重构

> 我们希望程序： 
> - 容易阅读
> - 所有逻辑都只在唯一地点指定
> - 新的改动不会危及现有行为
> - 尽可能简单表达条件逻辑

#### 重构的难题

* 数据库
* 修改接口

> 发布接口 vs 公开接口：<br/>
> 接口一旦发布，你就再也无法仅仅修改调用者而能够安全地修改接口了。

* 难以通过重构手法完成的设计改动

> 是否存在某些核心设计决策，无法以重构手法修改？<br/>
> 考虑候选设计方案时，我会问自己：将某个设计重构为另一个设计的难度有多大？如果看上去很简单，我就不必太担心选择是否得当，于是我就会选最简单的设计，哪怕它不能覆盖所有潜在需求也没关系。

* 何时不该重构

> 重写 vs 重构：<br/>
> 重写（而非重构）的一个清楚讯号就是——现有代码根本不能正常运作。

#### 重构与设计

重构改变了预先设计的角色。<br/>
如果没有重构，你就必须保证预先做出的设计正确无误，这个压力太大了。

#### 重构与性能

除了对性能有严格要求的实时系统，其他任何情况下"编写快速软件"的秘密就是：首先写出可调的软件，然后调整它以求获得足够速度。